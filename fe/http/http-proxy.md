# http代理

## 代理和网关的区别
代理连接的是连个或多个使用相同协议的应用程序；而网关连接的则是两个或者多个使用不同协议的端点。

## 代理获取流量的方法
- 用户自己设置，将流量先发送给代理服务器（e.g. proxyomega）
- 拦截流量。一般在监视http流量的路由设备或者交换设备进行
- 修改DNS。
- 修改Web服务器。发送重定向报文。

## 报文追踪
via首部字段列出了报文途经的每个中间节点有关的信息。报文每经过一个节点都必须将这个中间节点添加到via列表的末尾。
```
via: 1.1 cache.joes.com，1.1 proxy.irenes.com
```
一般包含四个部分：协议名（默认为http），协议版本，节点名，节点注释（可选）。

用TRACE方法可以跟踪经过的代理。用Max-forward字段可以限制它的跳转次数。

## 代理认证
代理服务器可能需要客户端提供证书来进行代理访问。如果证书无效/没有提供，则会返回407（proxy authentication required），并在Proxy-authenticate字段中告诉客户端如何获取证书。

客户端在Proxy-authenticate中提供证书后，代理就可以继续转发。

