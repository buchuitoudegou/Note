# Vue nextTick函数的用法和原理

## 用法
Vue在更新DOM的时候是异步执行的。在侦听到数据变化的时候，Vue会将数据变更缓冲到一个队列里面。如果一个Watcher被多次触发，它只会被加入到队列一次。例如：在设置vm.someData=xxx时，DOM不会立即被刷新，而是在执行完当前的同步代码后，引擎从异步队列中找到更新事件，并推入执行栈中执行。也就是说，我们无法在同步代码中检测到DOM的变化。

那如果，有需要在检测到DOM被改变之后触发某个事件要怎么办呢？这时，就可以用到nextTick函数，nextTick(cb, ctx)。callback会在DOM改变之后才触发，这时候就能访问到已经改变的DOM节点了。

## 原理
nextTick实际上利用的是js的事件循环机制。将callback放入到Promise.then中。即在同步代码中不会马上执行。当执行栈执行完毕后，引擎会执行所有微任务队列中的任务。DOM改变的事件会在异步队列的前方，执行完成后再执行callback。这时，callback就能访问到改变之后的DOM了。