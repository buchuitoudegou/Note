# js中的作用域及闭包
## 作用域
js中有一个很重要的概念，叫做执行环境（execution context）。执行环境中定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的*变量对象（variable object）*，环境中定义的所有变量和函数都保存在这个对象中。虽然我们在编写代码的时候无法访问这个对象，但是解释器在处理数据的时候会在后台使用它。

当代码在一个执行环境中执行的时候，会创建变量对象的一个*作用域链（scope chain）*。作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的最前端，始终是当前执行代码所在环境的*变量对象*。*如果这个环境是函数，那么将它的活动对象（activation object）作为变量对象*。活动对象一开始只有一个变量，即函数传进来的arguments，根据函数的定义，还会有一些函数中需要用到的局部变量。

而作用域链中的下一个变量对象是外部环境（即这个函数在哪里被调用），依次类推，最后一个总是全局环境的变量对象。

### 变量对象和活动对象
变量对象（variable object）是在函数创建阶段就有了（不需要被调用），它里面储存了一些变量的声明，函数声明，arguments。全局上下文中的变量对象就是全局变量及一些函数的声明。而在函数环境中的变量对象一般由活动对象扮演。

活动对象（activation object）是在函数被调用阶段才创建，它包括了局部变量、arguments、this的指向、以及有命名的参数。在刚进入函数时，所有的局部变量声明已完成，但未赋值；而函数声明则已经可以正常访问（函数变量名指向函数的引用）。


## 闭包
```js
function foo() {
  var a = 10;
  function innerFoo() {
    var rand = Math.random();
    return  ++a + rand;
  }
  return innerFoo;
}
```
先给闭包下一个定义：有权访问另一个函数作用域中的变量的函数叫做闭包。当函数innerFoo被返回的时候，它的作用域链被初始化为< foo AO >-> < global VO >，当innerFoo在全局作用域中被执行的时候，它会再创建一个< innerFoo AO >作用域，插入到作用域链的最前端。而foo中的变量a，则因为在foo结束时，仍有作用域链在引用该对象，它不会被内存回收。